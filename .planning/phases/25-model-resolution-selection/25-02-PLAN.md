---
phase: 25-model-resolution-selection
plan: 02
type: execute
wave: 2
depends_on: ["25-01"]
files_modified:
  - src/i18n/types.ts
  - src/i18n/locales/fr.ts
  - src/i18n/locales/en.ts
  - src/components/settings/ProviderCard.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User can select a model from a dropdown in each built-in provider card in AI Settings"
    - "Selected model persists across app restarts via localStorage"
    - "Model dropdown shows all models from the provider's registry entry"
    - "Default model is pre-selected when no user choice persisted"
  artifacts:
    - path: "src/components/settings/ProviderCard.tsx"
      provides: "Model selection dropdown with persistence"
      contains: "selectedModel"
    - path: "src/i18n/types.ts"
      provides: "modelLabel translation key"
      contains: "modelLabel"
    - path: "src/i18n/locales/fr.ts"
      provides: "French translation for model label"
      contains: "modelLabel"
    - path: "src/i18n/locales/en.ts"
      provides: "English translation for model label"
      contains: "modelLabel"
  key_links:
    - from: "src/components/settings/ProviderCard.tsx"
      to: "src/lib/ai.ts"
      via: "getSelectedModel and setSelectedModel imports"
      pattern: "import.*getSelectedModel.*setSelectedModel.*from"
    - from: "src/components/settings/ProviderCard.tsx"
      to: "localStorage"
      via: "setSelectedModel persists choice"
      pattern: "setSelectedModel\\(provider\\.id"
---

<objective>
Add model selection dropdown to built-in provider cards (PROV-01).

Purpose: Users currently cannot choose which model to use for each provider. The provider registry already has `models[]` arrays (4 Groq models, 3 Gemini, 4 OpenAI), but no UI exposes them. This plan adds a model dropdown to ProviderCard that persists the selection via the helpers created in Plan 01.

Output: Model dropdown in ProviderCard, i18n keys for labels, persisted model selection.
</objective>

<execution_context>
@C:/Users/Boris/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Boris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-model-resolution-selection/25-RESEARCH.md
@.planning/phases/25-model-resolution-selection/25-01-SUMMARY.md

@src/components/settings/ProviderCard.tsx
@src/i18n/types.ts
@src/i18n/locales/fr.ts
@src/i18n/locales/en.ts
@src/lib/ai-provider-registry.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add i18n translation key for model label</name>
  <files>src/i18n/types.ts, src/i18n/locales/fr.ts, src/i18n/locales/en.ts</files>
  <action>
**In `src/i18n/types.ts`:**

Add `modelLabel: string;` to the `settings` section of the `Translations` interface. Place it after the `geminiRecommended: string;` line (end of settings block, before the closing `};`).

**In `src/i18n/locales/fr.ts`:**

Add `modelLabel: 'Modele',` to the `settings` object. Place it after the `geminiRecommended` entry, before the closing `},` of the settings block.

**In `src/i18n/locales/en.ts`:**

Add `modelLabel: 'Model',` to the `settings` object. Place it after the `geminiRecommended` entry, before the closing `},` of the settings block.
  </action>
  <verify>Run `pnpm build` — TypeScript enforces completeness, so any missing locale key will fail the build.</verify>
  <done>Both locale files have `modelLabel` key. Types interface updated. Build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Add model dropdown to ProviderCard</name>
  <files>src/components/settings/ProviderCard.tsx</files>
  <action>
**Imports:**

Add `useEffect` to the React import (currently only imports `useState`):
```typescript
import { useState, useEffect } from 'react';
```

Add imports for the model persistence helpers from ai.ts (created in Plan 01):
```typescript
import { hasApiKey, getApiKey, setApiKey, clearApiKey, resetClient, getSelectedModel, setSelectedModel } from '../../lib/ai';
```

**State:**

Add a new state variable after the existing `healthCheck` state (~line 31):
```typescript
const [selectedModelId, setSelectedModelId] = useState<string>(provider.defaultModel);
```

**Effect for loading persisted model:**

Add a `useEffect` after the state declarations to load the persisted model when the card becomes active:
```typescript
useEffect(() => {
  if (isActive) {
    const persisted = getSelectedModel(provider.id);
    setSelectedModelId(persisted || provider.defaultModel);
  }
}, [isActive, provider.id, provider.defaultModel]);
```

**Model change handler:**

Add a handler function after `handleTestConnection`:
```typescript
const handleModelChange = (modelId: string) => {
  setSelectedModelId(modelId);
  setSelectedModel(provider.id, modelId);
  setSaved(true);
  setTimeout(() => setSaved(false), 2000);
};
```

**UI: Model dropdown:**

Insert a model dropdown section AFTER the API key input `</div>` (after line 189, the closing `</div>` of the API key input container) and BEFORE the action buttons `<div>` (line 192 `{/* Action buttons */}`).

Add this JSX:

```tsx
{/* Model selection */}
{provider.models && provider.models.length > 1 && (
  <div>
    <label className="block text-sm font-medium text-on-surface-secondary mb-2">
      {t.settings.modelLabel}
    </label>
    <select
      value={selectedModelId}
      onChange={(e) => handleModelChange(e.target.value)}
      className="w-full px-3 py-2 border border-input-border rounded-lg bg-input-bg text-on-surface focus:ring-2 focus:ring-accent focus:border-accent outline-none text-sm"
    >
      {provider.models.map(model => (
        <option key={model.id} value={model.id}>
          {model.name}
        </option>
      ))}
    </select>
  </div>
)}
```

**Key details:**
- Only show the dropdown if the provider has more than 1 model (`provider.models.length > 1`)
- Use `text-on-surface` for the select text to match theme (dark mode compatible)
- Use `bg-input-bg` and `border-input-border` for consistent styling with the API key input
- The dropdown is inside the `{isActive && (...)}` block, so it only appears for the selected provider
- The `setSaved(true)` call reuses the existing "saved" feedback mechanism to show visual confirmation
  </action>
  <verify>
Run `pnpm build` — must compile with no errors.

Manual verification checklist:
1. Open AI Settings
2. Click on each built-in provider (Groq, Gemini, OpenAI)
3. Verify model dropdown appears below API key input
4. Change model selection
5. Close and reopen AI Settings — selection should persist
6. Verify dark mode renders correctly
  </verify>
  <done>Model dropdown appears in ProviderCard for all 3 built-in providers. Selection persists in localStorage. Dropdown styled consistently with existing inputs. Build passes.</done>
</task>

</tasks>

<verification>
1. `pnpm build` passes with zero errors
2. `t.settings.modelLabel` resolves correctly in both FR and EN
3. ProviderCard renders model dropdown when provider has > 1 model
4. Model selection is persisted via `setSelectedModel` (localStorage key: `ai-model-{providerId}`)
5. Persisted model is loaded on component mount via `getSelectedModel`
6. No unused imports or dead code
7. Dark mode renders select element correctly
</verification>

<success_criteria>
- PROV-01 gap is closed: User can select a model for each built-in provider
- Model dropdown shows all models from the provider registry
- Selection persists across sessions via localStorage
- Visual feedback shown when model is changed (reuses "saved" indicator)
- i18n keys added for both FR and EN
- Build passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/25-model-resolution-selection/25-02-SUMMARY.md`
</output>
