---
phase: 23-settings-ui-split-provider-config
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/settings/AppSettingsModal.tsx
  - src/components/settings/AISettingsModal.tsx
  - src/components/settings/ProviderCard.tsx
  - src/components/settings/CustomProviderForm.tsx
  - src/components/settings/CustomProviderList.tsx
autonomous: true
must_haves:
  truths:
    - "AppSettingsModal renders language selector, theme toggle, updates, changelog, export, backups sections"
    - "AISettingsModal renders tabbed UI (Providers / Custom) with built-in provider cards and API key config"
    - "Built-in provider cards show status badge (configured/not configured) and allow API key entry"
    - "Custom provider tab allows adding new OpenAI-compatible providers with name, baseURL, model, API key"
    - "Custom provider list shows existing custom providers with edit and delete actions"
    - "Both modals compile without TypeScript errors"
  artifacts:
    - path: "src/components/settings/AppSettingsModal.tsx"
      provides: "App-level settings modal (language, theme, updates, changelog, export, backups)"
      min_lines: 100
    - path: "src/components/settings/AISettingsModal.tsx"
      provides: "AI settings modal with tabbed navigation (Providers, Custom)"
      min_lines: 80
    - path: "src/components/settings/ProviderCard.tsx"
      provides: "Reusable provider card with icon, status badge, API key input"
      min_lines: 50
    - path: "src/components/settings/CustomProviderForm.tsx"
      provides: "Add/edit custom provider form with Zod validation"
      min_lines: 60
    - path: "src/components/settings/CustomProviderList.tsx"
      provides: "List of custom providers with edit/delete actions"
      min_lines: 40
  key_links:
    - from: "src/components/settings/AISettingsModal.tsx"
      to: "src/lib/ai-provider-registry.ts"
      via: "BUILT_IN_PROVIDERS, getAllProviders, loadCustomProviders"
      pattern: "import.*from.*ai-provider-registry"
    - from: "src/components/settings/CustomProviderForm.tsx"
      to: "src/lib/ai-provider-registry.ts"
      via: "validateCustomProvider, addCustomProvider"
      pattern: "addCustomProvider|validateCustomProvider"
    - from: "src/components/settings/ProviderCard.tsx"
      to: "src/lib/ai.ts"
      via: "hasApiKey, getApiKey, setApiKey, clearApiKey"
      pattern: "hasApiKey|getApiKey|setApiKey"
---

<objective>
Create AppSettingsModal and AISettingsModal with all sub-components as standalone new files. These modals are NOT yet wired into App.tsx — that happens in later plans. This plan focuses on building the complete UI components.

Purpose: Split the monolithic 774-line SettingsModal into two focused panels, and build the custom provider CRUD UI that consumes the Phase 22 registry.

Output: Five new component files ready to be wired in.
</objective>

<execution_context>
@C:/Users/Boris/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Boris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 22 summaries (registry patterns)
@.planning/phases/22-provider-registry-core-refactor/22-01-SUMMARY.md
@.planning/phases/22-provider-registry-core-refactor/22-03-SUMMARY.md

# Source files to understand
@src/components/settings/SettingsModal.tsx
@src/lib/ai-provider-registry.ts
@src/types/aiProvider.ts
@src/lib/ai.ts
@src/components/ui/Modal.tsx
@src/components/ui/Icons.tsx
@src/i18n/types.ts
@src/i18n/locales/fr.ts
@src/i18n/locales/en.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AppSettingsModal and AISettingsModal with sub-components</name>
  <files>
    src/components/settings/AppSettingsModal.tsx
    src/components/settings/AISettingsModal.tsx
    src/components/settings/ProviderCard.tsx
    src/components/settings/CustomProviderForm.tsx
    src/components/settings/CustomProviderList.tsx
  </files>
  <action>
Create five new component files. Do NOT modify any existing files — these are standalone new components.

**1. AppSettingsModal.tsx** — Extract from SettingsModal the following sections:
- Language selector (SUPPORTED_LOCALES buttons)
- Theme toggle (light/dark/system)
- Update section (Tauri only — check updates button)
- Changelog section (WhatsNewModal trigger)
- Export section (Tauri only — markdown export)
- Backup & Restore section (Tauri only — create/restore backups)

Props interface:
```typescript
interface AppSettingsModalProps {
  isOpen: boolean;
  onClose: () => void;
  updater: ReturnType<typeof useUpdater>;
  projectPath?: string;
}
```

Use `Modal` from `../ui/Modal` with `size="md"`. Use `useTranslation()` and `useTheme()`. Reuse exact same i18n keys from SettingsModal (t.settings.*). No footer needed — all actions are inline buttons.

Keep the maintenance section REMOVED (noted as "temporarily disabled" in STATE.md pending todos).

**2. AISettingsModal.tsx** — New modal with tabbed navigation:
- Props: `{ isOpen, onClose }`
- Two tabs: "Providers" and "Custom" (use useState for activeTab)
- Tab bar: horizontal buttons at top with accent underline on active
- Providers tab: render one `ProviderCard` per BUILT_IN_PROVIDERS entry
- Custom tab: render `CustomProviderList`
- Also include the AI Questioning Mode toggle (extracted from SettingsModal)
- Also include the AI Feedback Stats section (needs projectPath prop — make it optional)
- Use `Modal` with `size="lg"` and title from i18n (use t.settings.title for now, will be updated once i18n keys are added in Plan 02)
- Import BUILT_IN_PROVIDERS from `../../lib/ai-provider-registry`

Props interface:
```typescript
interface AISettingsModalProps {
  isOpen: boolean;
  onClose: () => void;
  projectPath?: string;
}
```

**3. ProviderCard.tsx** — Reusable card for built-in providers:
- Props: `{ provider: ProviderConfig; isActive: boolean; onSelect: () => void }`
- Shows provider icon (GroqIcon/GeminiIcon/OpenAIIcon based on provider.id)
- Shows status badge: "Configured" (green) or "Not configured" (muted) using hasApiKey
- Shows provider name and description
- When selected (isActive), shows API key input field with show/hide toggle
- Save button saves key via setApiKey(key, provider.id), calls resetClient()
- Clear button via clearApiKey(provider.id), calls resetClient()
- Use provider-specific accent colors (orange for groq, blue for gemini, emerald for openai)
- Import from `../../lib/ai` for hasApiKey/getApiKey/setApiKey/clearApiKey/resetClient

**4. CustomProviderForm.tsx** — Form for adding/editing custom providers:
- Props: `{ onSuccess: () => void; onCancel: () => void; editProvider?: ProviderConfig }`
- Fields: name (text), baseURL (url), defaultModel (text), apiKey (password, optional)
- Use validateCustomProvider from registry for validation
- On submit: if editProvider, call removeCustomProvider(old) then addCustomProvider(new) — registry has no update function, so remove+add is the pattern
- For new: call addCustomProvider directly
- API key: store via setApiKey(key, providerId) from ai.ts — use getCustomProviderApiKeyKey from constants/storage
- Show validation errors inline under each field
- Use Tailwind form styling consistent with SettingsModal inputs
- Import from `../../lib/ai-provider-registry` and `../../lib/ai`

**5. CustomProviderList.tsx** — List custom providers with CRUD:
- Uses loadCustomProviders() to get list
- Each row: provider name, baseURL, edit button, delete button
- Delete: confirm dialog, then removeCustomProvider(id), then reload list
- Edit: opens CustomProviderForm in edit mode
- Add button: opens CustomProviderForm in create mode
- Empty state: "No custom providers. Add Ollama, LM Studio, or other OpenAI-compatible endpoints."
- Import EditIcon, TrashIcon, PlusIcon from Icons

**IMPORTANT:**
- Use `useTranslation()` for ALL user-facing strings. For NEW strings that don't exist yet in i18n types, use hardcoded English strings for now (they'll be added to i18n in Plan 02). Comment with `// TODO: i18n` next to each hardcoded string so Plan 02 can find and replace them.
- Do NOT modify SettingsModal.tsx or any existing file — only create new files.
- All components must use semantic Tailwind tokens (bg-surface, text-on-surface, border-outline, etc.)
- All components must support dark mode via the existing theme tokens.
  </action>
  <verify>
Since new files are not yet imported anywhere, Vite/TypeScript won't check them during `pnpm build`. To ensure type-correctness:

1. Create a temporary barrel file `src/components/settings/_verify-plan01.ts` that imports all 5 new components:
   ```typescript
   export { AppSettingsModal } from './AppSettingsModal';
   export { AISettingsModal } from './AISettingsModal';
   export { ProviderCard } from './ProviderCard';
   export { CustomProviderForm } from './CustomProviderForm';
   export { CustomProviderList } from './CustomProviderList';
   ```
2. Add a temporary import in `src/App.tsx` at the top (after existing imports): `import './ components/settings/_verify-plan01';`
3. Run `pnpm build` — must pass with zero TypeScript errors.
4. After build passes, **remove** the temporary barrel file and the temporary import from App.tsx.
5. Run `pnpm build` again to confirm clean state.
  </verify>
  <done>
Five new component files exist at the specified paths. `pnpm build` passes. AppSettingsModal contains language, theme, updates, changelog, export, backups. AISettingsModal has two-tab UI with providers and custom sections. ProviderCard shows status badges and API key config. CustomProviderForm validates with Zod. CustomProviderList shows CRUD for custom providers.
  </done>
</task>

</tasks>

<verification>
1. All five files exist: AppSettingsModal.tsx, AISettingsModal.tsx, ProviderCard.tsx, CustomProviderForm.tsx, CustomProviderList.tsx
2. Temporary barrel import verifies all 5 components compile without TypeScript errors
3. `pnpm build` passes without errors (with temporary barrel, then again after removal)
4. No modifications to existing files (except temporary import added and removed during verification)
5. Each component uses Modal, Icons, and ai-provider-registry imports correctly
</verification>

<success_criteria>
- All five component files created and type-check
- AppSettingsModal covers all non-AI sections from SettingsModal
- AISettingsModal has tabbed navigation with Providers and Custom tabs
- ProviderCard shows provider status and allows API key configuration
- CustomProviderForm validates input via registry and handles add/edit
- CustomProviderList handles CRUD with delete confirmation
- `pnpm build` passes
</success_criteria>

<output>
After completion, create `.planning/phases/23-settings-ui-split-provider-config/23-01-SUMMARY.md`
</output>
